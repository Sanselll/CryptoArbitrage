================================================================================
TESTING MODEL INFERENCE (DIRECT)
================================================================================

ğŸ² Random seed: 42 (deterministic mode enabled)
   torch.use_deterministic_algorithms(True)
   cudnn.deterministic=True, cudnn.benchmark=False

1. Creating test environment...
   Pre-converting 34,668 opportunities to dict format...
   âœ“ Pre-conversion complete (34,668 records)
âœ… Test environment created
   Data: data/production/rl_opportunities.csv
   ğŸŒ FULL TEST MODE: Testing on ENTIRE test dataset
   Episode length: 5.2 days (2025-11-13 11:40:00.011682+00:00 to 2025-11-18 15:20:00.002174+00:00)
   Total steps: ~1,483 steps at 5-minute intervals
   Step interval: 5 minute(s) (0.0833 hours)
   Initial capital: $10,000.00
   Leverage: 2.0x
   Utilization: 80%
   Max Positions: 2
   Price History: data/production/symbol_data (dynamic funding updates enabled)

2. Creating network...
âœ… Network created (791,349 parameters)

3. Creating trainer...
âœ… Model compiled with torch.compile for faster training
âœ… Trainer created

4. Loading trained model...
âœ… Model loaded from checkpoints/v3-3/checkpoint_ep3650.pt
   Mode: Direct model inference

5. Running inference on 1 episode...
âœ… Feature scaler loaded from: /Users/sansel/Projects/CryptoArbitrage/ml_pipeline/trained_models/rl/feature_scaler_v2.pkl
   Episode 1: Reward=   1.62, P&L=$  59.02 (0.59%), Trades=425, Length=1484 steps

âœ… Inference test complete!

================================================================================
DETAILED EVALUATION METRICS (TEST SET)
================================================================================

ğŸ“Š Episode Metrics:
  Mean Reward:         1.62 Â± 0.00
  Mean Length:       1484.0 steps (5 min/step)

ğŸ’° P&L Metrics:
  Mean P&L (USD):  $   59.02
  Mean P&L (%):        0.59%
  Total P&L:       $   59.02

ğŸ“ˆ Trading Metrics:
  Total Trades:         425
  Winning Trades:         9
  Losing Trades:        416
  Win Rate:             2.1%
  Avg Duration:         0.5 hours

ğŸ¯ Opportunity Metrics:
  Opportunities/Ep:   11050
  Trades/Episode:     425.0
  Execution Rate:   3.8%

âš ï¸  Risk Metrics:
  Max Drawdown:        1.89%

ğŸ“Š Profitability Metrics:
  Profit Factor:       1.30

âš™ï¸  Configuration Used:
  Leverage:        2.0x
  Utilization:     80%
  Max Positions:   2

ğŸ¯ Composite Score: 0.4499
   (P&L: 0.117 | ProfitFactor: 0.650 | Drawdown: 0.981)

ğŸ’¾ Trade Records:
   Total trades: 425
   Closed trades: 425
   Open positions: 0
   Saved to: trades_inference.csv

================================================================================
âœ… ALL INFERENCE TESTS PASSED
================================================================================
